<app-navbar></app-navbar>
<div class="gradient-custom min-vh-100 p-4">
  <div class="background-glass p-4">
    
    <!-- Loading -->
    <div *ngIf="isLoading" class="text-center py-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Carregando...</span>
      </div>
      <p class="mt-2">Carregando detalhes do evento...</p>
    </div>

    <!-- Conteúdo principal -->
    <div *ngIf="!isLoading && evento">
      
      <!-- Cabeçalho com título e botões de ação -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="system-title mb-1">{{ evento.titulo }}</h2>
          <p class="text-muted mb-0">ID: {{ evento.eventoId }}</p>
        </div>
        <div class="btn-group">
          <button class="btn btn-outline-secondary" (click)="voltarParaLista()">
            <i class="fas fa-arrow-left me-1"></i> Voltar
          </button>
          <button class="btn btn-outline-primary" (click)="editarEvento()">
            <i class="fas fa-edit me-1"></i> Editar
          </button>
        </div>
      </div>

      <!-- Seção: Controles de Status do Evento -->
      <div class="card mb-4 no-hover">
        <div class="card-header">
          <h5 class="card-title mb-0">Controles do Evento</h5>
        </div>
        <div class="card-body">
          <div class="d-flex gap-2 flex-wrap">
            <!-- Botão Iniciar Evento -->
            <button class="btn btn-success" 
                    (click)="iniciarEvento()"
                    *ngIf="evento.status === statusEvento.AGENDADO || evento.status === statusEvento.PAUSADO"
                    [disabled]="isLoadingAction">
              <i class="fas fa-play me-1"></i> Iniciar Evento
            </button>

            <!-- Botão Realizar Check-in Biométrico -->
            <button class="btn btn-primary" 
                    (click)="realizarCheckInBiometrico()"
                    *ngIf="evento.status === statusEvento.EM_ANDAMENTO"
                    [disabled]="isLoadingAction || isCapturingBiometry">
              <i class="fas fa-fingerprint me-1"></i> 
              {{ isCapturingBiometry ? 'Capturando...' : 'Realizar Check-in' }}
            </button>

            <!-- Botão Encerrar Evento -->
            <button class="btn btn-warning" 
                    (click)="encerrarEvento()"
                    *ngIf="evento.status === statusEvento.EM_ANDAMENTO"
                    [disabled]="isLoadingAction">
              <i class="fas fa-flag-checkered me-1"></i> Encerrar Evento
            </button>

            <!-- Botão Cancelar Evento -->
            <button class="btn btn-danger" 
                    (click)="cancelarEvento()"
                    *ngIf="evento.status !== statusEvento.FINALIZADO && evento.status !== statusEvento.CANCELADO"
                    [disabled]="isLoadingAction">
              <i class="fas fa-times me-1"></i> Cancelar Evento
            </button>

            <!-- Botão Pausar/Retomar Evento -->
            <button class="btn btn-info" 
                    (click)="evento.status === statusEvento.PAUSADO ? retomarEvento() : pausarEvento()"
                    *ngIf="evento.status === statusEvento.EM_ANDAMENTO || evento.status === statusEvento.PAUSADO"
                    [disabled]="isLoadingAction">
              <i class="fas fa-pause me-1" *ngIf="evento.status === statusEvento.EM_ANDAMENTO"></i>
              <i class="fas fa-play me-1" *ngIf="evento.status === statusEvento.PAUSADO"></i>
              {{ evento.status === statusEvento.EM_ANDAMENTO ? 'Pausar Evento' : 'Retomar Evento' }}
            </button>
          </div>

          <!-- Mensagem de status da ação -->
          <div *ngIf="actionMessage" class="alert alert-info mt-3 mb-0">
            {{ actionMessage }}
          </div>

          <!-- Mensagem de erro da biometria -->
          <div *ngIf="biometryError" class="alert alert-danger mt-3 mb-0">
            <i class="fas fa-exclamation-triangle me-2"></i>
            {{ biometryError }}
          </div>
        </div>
      </div>

      <!-- Seção 1: Informações do Evento -->
      <div class="card mb-4 no-hover">
        <div class="card-header">
          <h5 class="card-title mb-0">Informações do Evento</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <p><strong>Descrição:</strong></p>
              <p class="text-muted">{{ evento.descricao }}</p>
              
              <p><strong>Data e Hora:</strong></p>
              <p class="text-muted">{{ formatarDataHora(evento.dataHora) }}</p>
            </div>
            <div class="col-md-6">
              <p><strong>Categoria:</strong></p>
              <p class="text-muted">{{ evento.categoria }}</p>
              
              <p><strong>Carga Horária:</strong></p>
              <p class="text-muted">{{ evento.cargaHoraria }} horas</p>
              
              <p><strong>Status:</strong></p>
              <span class="badge" [ngClass]="getStatusBadgeClass(evento?.status)">
                {{ getStatusDescricao(evento?.status) }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Seção 2: Check-ins Realizados -->
      <div class="card no-hover">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">Check-ins Realizados</h5>
          <span class="badge bg-primary">{{ checkIns.length }}</span>
        </div>
        <div class="card-body">
          <div *ngIf="checkIns.length > 0; else semCheckIns">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>CPF</th>
                    <th>Data/Hora</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let checkIn of checkIns">
                    <td>{{ checkIn.usuarioNome }}</td>
                    <td>{{ formatarCPF(checkIn.usuarioCpf) }}</td>
                    <td>{{ formatarDataHora(checkIn.dataHoraCheckin) }}</td>
                    <td>
                      <span class="badge" [ngClass]="{
                        'bg-success': checkIn.status === statusCheckIn.PRESENTE,
                        'bg-danger': checkIn.status === statusCheckIn.AUSENTE,
                        'bg-warning': checkIn.status === statusCheckIn.PENDENTE,
                        'bg-secondary': checkIn.status === statusCheckIn.CANCELADO
                      }">
                        {{ getStatusCheckInDescricao(checkIn.status) }}
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <ng-template #semCheckIns>
            <p class="text-muted text-center mb-0">Nenhum check-in realizado ainda.</p>
          </ng-template>
        </div>
      </div>

    </div>

    <!-- Mensagem de erro -->
    <div *ngIf="!isLoading && !evento" class="alert alert-danger text-center">
      <p>Evento não encontrado.</p>
      <button class="btn btn-primary" (click)="voltarParaLista()">Voltar para a lista</button>
    </div>

  </div>
</div>